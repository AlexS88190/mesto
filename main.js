(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r=t((function e(t,r,o,i,l,a){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"_getTemplate",(function(){return document.querySelector(u._cardSelector).content.querySelector(".elements__item").cloneNode(!0)})),n(this,"generateCard",(function(){return u._initElements(),u._addEventListener(),u._linkCard.src=u._link,u._linkCard.alt=u._title,u._nameCard.textContent=u._title,u._likeCounterElement.textContent=u._likeCounter,u._likes.find((function(e){return e._id===u._profileId}))&&u._likeButton.classList.add("elements__like-button_active"),u._profileId!==u._ownerId&&u._trashButton.remove(),u._cardElement})),n(this,"_removeCard",(function(e){u._openRemovePopup((function(){return u._api.deleteCard(u._id).then((function(e){u._cardElement.remove(),u._destroyElements()}))}))})),n(this,"_destroyElements",(function(){u._trashButton=null,u._cardElement=null,u._likeButton=null,u._nameCard=null,u._linkCard=null})),n(this,"_initElements",(function(){u._cardElement=u._getTemplate(),u._linkCard=u._cardElement.querySelector(".elements__image"),u._nameCard=u._cardElement.querySelector(".elements__title"),u._trashButton=u._cardElement.querySelector(".elements__trash"),u._likeButton=u._cardElement.querySelector(".elements__like-button"),u._likeCounterElement=u._cardElement.querySelector(".elements__like-counter")})),n(this,"_likeCard",(function(e){u._likeButton.classList.contains(u._likeButtonActiveClass)?u._api.dislike(u._id).then((function(e){u._likeButton.classList.remove(u._likeButtonActiveClass),u._likeCounter=u._likeCounter-1,u._likeCounterElement.textContent=u._likeCounter})):u._api.like(u._id).then((function(e){u._likeButton.classList.add(u._likeButtonActiveClass),u._likeCounter=u._likeCounter+1,u._likeCounterElement.textContent=u._likeCounter}))})),n(this,"_handleOpenZoomPopup",(function(e){u._openZoomPopup(u._title,u._link)})),n(this,"_addEventListener",(function(){u._trashButton.addEventListener("click",u._removeCard),u._likeButton.addEventListener("click",u._likeCard),u._linkCard.addEventListener("click",u._handleOpenZoomPopup)})),this._api=t,this._profileId=r,this._id=o._id,this._title=o.name,this._link=o.link,this._likes=o.likes,this._likeCounter=o.likes.length,this._ownerId=o.owner._id,this._cardSelector=i,this._openZoomPopup=l,this._openRemovePopup=a,this._likeButtonActiveClass="elements__like-button_active"}));function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"enableValidation",(function(){r._formElement.addEventListener("submit",(function(e){e.preventDefault()})),r._setEventListeners()})),i(this,"_setEventListeners",(function(){r._inputList.forEach((function(e){e.addEventListener("input",(function(){r._updateInputErrors(e),r.toggleButtonState()}))}))})),i(this,"_updateInputErrors",(function(e){r._isInputValid(e)?r._hideInputError(e):r._showInputError(e,e.validationMessage)})),i(this,"_hideInputError",(function(e){var t=r._formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(r._selectors.inputErrorClass),t.classList.remove(r._selectors.errorClass),t.textContent=""})),i(this,"_showInputError",(function(e,t){var n=r._formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(r._selectors.inputErrorClass),n.textContent=t,n.classList.add(r._selectors.errorClass)})),i(this,"toggleButtonState",(function(){r._formElement.checkValidity()?(r._buttonElement.classList.remove(r._selectors.inactiveButtonClass),r._buttonElement.removeAttribute("disabled")):(r._buttonElement.classList.add(r._selectors.inactiveButtonClass),r._buttonElement.setAttribute("disabled","disabled"))})),i(this,"_isInputValid",(function(e){return e.validity.valid})),this._selectors=t,this._formElement=n,this._inputList=Array.from(this._formElement.querySelectorAll(this._selectors.inputSelector)),this._buttonElement=this._formElement.querySelector(this._selectors.submitButtonSelector)}var t,n;return t=e,(n=[{key:"resetValidation",value:function(){var e=this;this.toggleButtonState(),this._inputList.forEach((function(t){e._hideInputError(t)}))}}])&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._items=r,this._renderer=o,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(){var e=this;this._items.forEach((function(t){var n=e._renderer(t);e.addItem(n)}))}},{key:"addItem",value:function(e){this._container.prepend(e)}},{key:"setItems",value:function(e){this._items=e}}])&&a(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=s((function e(t){var n=this,r=t.profileTitleSelector,o=t.profileSubTitleSelector,i=t.profileAvatarSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),p(this,"getUserInfo",(function(){return{profileTitle:n._profileTitleElement.textContent,profileSubTitle:n._profileSubTitleElement.textContent}})),p(this,"setUserInfo",(function(e){var t=e.profileTitle,r=e.profileSubTitle;n._profileTitleElement.textContent=t,n._profileSubTitleElement.textContent=r})),p(this,"setAvatar",(function(e){n._avatarElement.style.backgroundImage="url(".concat(e,")")})),this._profileTitleElement=document.querySelector(r),this._profileSubTitleElement=document.querySelector(o),this._avatarElement=document.querySelector(i)}));function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this),this._handleClosePopup=this._handleClosePopup.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){document.addEventListener("keydown",this._handleEscClose),this._popup.classList.add("popup_opened")}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){this._popup.addEventListener("click",this._handleClosePopup)}},{key:"_handleClosePopup",value:function(e){(e.target.classList.contains("popup__close-button")||e.target.classList.contains("popup"))&&this.close()}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}}])&&_(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=b(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},m.apply(this,arguments)}function b(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}function E(e,t){if(t&&("object"===h(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(l,e);var t,n,r,o,i=(r=l,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(r);if(o){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return E(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this,e))._popupZoomImage=t._popup.querySelector(".popup__image"),t._popupZoomTitle=t._popup.querySelector(".popup__zoom-title"),t}return t=l,(n=[{key:"open",value:function(e,t){m(k(l.prototype),"open",this).call(this),this._popupZoomImage.src=t,this._popupZoomImage.alt=e,this._popupZoomTitle.textContent=e}}])&&y(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),l}(d);function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(){return w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=O(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},w.apply(this,arguments)}function O(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}function P(e,t){return P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},P(e,t)}function j(e,t){if(t&&("object"===S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return L(e)}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e){return T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},T(e)}var I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&P(e,t)}(l,e);var t,n,r,o,i=(r=l,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=T(r);if(o){var n=T(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return j(this,e)});function l(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(n=i.call(this,e))._form=n._popup.querySelector(".popup__form"),n._submitCallback=t,n._handleSubmitCallback=n._handleSubmitCallback.bind(L(n)),n}return t=l,(n=[{key:"setEventListeners",value:function(){w(T(l.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",this._handleSubmitCallback)}},{key:"_handleSubmitCallback",value:function(e){e.preventDefault(),this._submitCallback(this._getInputValues())}},{key:"_getInputValues",value:function(){var e={};return this._popup.querySelectorAll(".popup__input").forEach((function(t){e[t.name]=t.value})),e}},{key:"close",value:function(){w(T(l.prototype),"close",this).call(this),this._form.reset()}},{key:"setSubmitCallBack",value:function(e){this._submitCallback=e}}])&&g(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),l}(d);function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var R=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),B(this,"getProfileInfo",(function(){return o._addHandlers(fetch("".concat(o._baseUrl,"/users/me"),{headers:o._headers}))})),B(this,"updateProfileInfo",(function(e,t){return o._addHandlers(fetch("".concat(o._baseUrl,"/users/me"),{method:"PATCH",headers:o._headers,body:JSON.stringify({name:e,about:t})}))})),B(this,"updateAvatar",(function(e){return o._addHandlers(fetch("".concat(o._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o._headers,body:JSON.stringify({avatar:e})}))})),B(this,"getCards",(function(){return o._addHandlers(fetch("".concat(o._baseUrl,"/cards"),{headers:o._headers}))})),B(this,"addCard",(function(e,t){return o._addHandlers(fetch("".concat(o._baseUrl,"/cards"),{method:"POST",headers:o._headers,body:JSON.stringify({name:e,link:t})}))})),B(this,"deleteCard",(function(e){return o._addHandlers(fetch("".concat(o._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:o._headers}))})),B(this,"like",(function(e){return console.log(e),o._addHandlers(fetch("".concat(o._baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:o._headers}))})),B(this,"dislike",(function(e){return o._addHandlers(fetch("".concat(o._baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:o._headers}))})),this._headers={authorization:n,"Content-Type":"application/json"},this._baseUrl="".concat(r,"/").concat(t)}var t,n;return t=e,(n=[{key:"_addHandlers",value:function(e){return e.then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}}])&&q(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),A={},x=new u({items:[],renderer:se},".elements__list"),U=new f({profileTitleSelector:".profile__title",profileSubTitleSelector:".profile__subtitle",profileAvatarSelector:".profile__avatar"}),H=new C(".popup_type_zoom");H.setEventListeners();var V=new I(".popup_type_place",(function(e){var t=e.place,n=e.link;z.addCard(t,n).then((function(e){var t;t=se(e),x.addItem(t),V.close()}))}));V.setEventListeners();var Z=new I(".popup_type_profile",(function(e){z.updateProfileInfo(e.name_profile,e.about_profile).then((function(){U.setUserInfo({profileTitle:e.name_profile,profileSubTitle:e.about_profile})})),Z.close()}));Z.setEventListeners();var D=new I(".popup_type_update",(function(e){z.updateAvatar(e.link).then((function(){U.setAvatar(e.link)})),D.close()}));D.setEventListeners();var N=new I(".popup_type_remove");N.setEventListeners();var z=new R("cohort-41","c5ad47cd-94e1-4e0d-ba61-6865eeedf90c","https://mesto.nomoreparties.co/v1"),J=document.querySelector(".popup_type_profile"),M=document.querySelector(".popup_type_place"),F=document.querySelector(".popup_type_update"),G=J.querySelector(".popup__form_profile"),K=G.querySelector(".popup__input_type_name"),Q=G.querySelector(".popup__input_type_about"),W=M.querySelector(".popup__form_place"),X=F.querySelector(".popup__form_update"),Y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},$=document.querySelector(".profile__edit-button"),ee=document.querySelector(".profile__add-button"),te=document.querySelector(".profile__avatar-button");function ne(e){var t=U.getUserInfo();K.value=t.profileTitle,Q.value=t.profileSubTitle,ae.resetValidation(),Z.open()}function re(e){ue.toggleButtonState(),V.open()}function oe(e,t){H.open(e,t)}function ie(){ce.toggleButtonState(),D.open()}function le(e){N.setSubmitCallBack((function(){e().then((function(){N.close()}))})),N.open()}var ae=new l(Y,G),ue=new l(Y,W),ce=new l(Y,X);function se(e){return new r(z,A._id,e,".card-template",oe,le).generateCard()}z.getProfileInfo().then((function(e){return U.setUserInfo({profileTitle:e.name,profileSubTitle:e.about}),U.setAvatar(e.avatar),e})).then((function(e){A=e,z.getCards().then((function(e){console.log(e),x.setItems(e),x.renderItems()})),$.addEventListener("click",ne),ee.addEventListener("click",re),te.addEventListener("click",ie),ae.enableValidation(),ue.enableValidation(),ce.enableValidation()}))})();